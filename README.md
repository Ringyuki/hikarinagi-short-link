# 短链接管理系统

为Hikarinagi设计的私有短链接生成和管理平台，基于 Next.js 15 构建。

## 功能特性

- 🔗 **短链接生成**: 快速生成短链接，支持自定义短码
- 📊 **数据统计**: 详细的点击统计和数据分析
- 🔒 **管理后台**: 安全的管理界面，支持链接管理和账号设置
- 💾 **数据管理**: 完整的数据导入导出功能，支持备份和迁移
- 🗑️ **数据清理**: 一键清空失效链接，保持数据库整洁
- 📱 **响应式设计**: 完美适配桌面端和移动端
- 🎨 **现代化UI**: 基于 Tailwind CSS 和 shadcn/ui 的美观界面
- 📈 **实时分析**: 点击趋势图表和热门链接排行

## 技术栈

- **前端**: Next.js 15, React 19, TypeScript
- **样式**: Tailwind CSS 4, shadcn/ui
- **数据库**: SQLite (better-sqlite3)
- **图表**: Recharts
- **其他**: 数据导入导出, 日期处理, 通知提示

## 快速开始

### 安装依赖

```bash
pnpm install
```

### 启动开发服务器

```bash
pnpm dev
```

应用将在 [http://localhost:3001](http://localhost:3001) 启动。

### 构建生产版本

```bash
pnpm build
pnpm start
```

## 使用说明

### 访问系统

这是一个私有的短链接管理系统，所有功能都需要通过管理后台访问：

1. 访问 [http://localhost:3001](http://localhost:3001) 会显示404页面
2. 点击"进入管理后台"或直接访问 [http://localhost:3001/admin](http://localhost:3001/admin)
3. 使用默认账号登录：
   - **用户名**: `admin`
   - **密码**: `admin123`

### 管理后台功能

登录后，您可以使用以下功能：

#### 1. 生成链接
- 输入原始链接
- 可选：设置标题、描述、自定义短码、过期时间
- 点击"生成短链接"
- 获得短链接和二维码

#### 2. 链接管理
- 查看所有生成的短链接
- 复制链接到剪贴板
- 查看链接统计信息
- 删除不需要的链接
- 清空失效链接（已删除/已过期）

#### 3. 统计分析
- 总链接数和总点击数
- 今日和本周点击统计
- 点击趋势图表（最近30天）
- 热门链接排行榜

#### 4. 数据管理
- **数据导出**: 备份所有链接和点击记录
- **数据导入**: 从备份文件恢复数据
- **数据库统计**: 查看详细的数据库统计信息
- **导入选项**: 覆盖现有数据或增量导入
- **安全提示**: 导入前会显示详细的操作说明和警告

#### 5. 账号设置
- 修改管理员密码
- 查看当前用户信息

## 数据管理功能

### 数据导出
- 导出格式：JSON
- 包含内容：所有链接、点击分析记录
- 文件命名：`shortlink-backup-YYYY-MM-DD.json`

### 数据导入
- 支持格式：JSON（系统导出的备份文件）
- 导入模式：
  - **增量导入**：保留现有数据，添加新数据
  - **覆盖导入**：清空现有数据，完全替换
- 安全机制：
  - 文件格式验证
  - 数据结构检查
  - 事务处理（失败时回滚）
  - 详细的错误报告

### 数据清理
- **清空失效链接**：删除已标记为删除的链接记录
- **清空过期链接**：删除已过期的链接记录
- **批量清理**：一次性清空所有失效和过期链接
- **关联清理**：自动删除相关的点击分析记录

## 数据库结构

系统使用 SQLite 数据库，包含以下表：

- `links`: 存储短链接信息
- `click_analytics`: 存储点击分析数据
- `admin_users`: 存储管理员账号信息

## 安全特性

- 🔐 基于 Cookie 的会话管理
- 🛡️ 管理页面访问控制
- 🔒 密码验证和修改
- 🚫 SQL 注入防护
- ⏰ 会话过期自动处理
- 🔐 私有系统，无公开访问入口
- 💾 数据导入导出权限验证
- 🗑️ 数据清理操作确认机制

## 部署建议

1. 确保 `data` 目录有写入权限
2. **重要**: 在生产环境中立即修改默认管理员密码
3. 配置反向代理（如 Nginx）
4. 启用 HTTPS
5. 定期备份数据库文件（使用数据导出功能）
6. 考虑设置防火墙规则限制访问
7. 定期清理失效链接以保持数据库性能

## 数据备份策略

### 推荐备份方案
1. **定期自动备份**：使用数据导出功能定期备份
2. **重要操作前备份**：在大量数据操作前先导出备份
3. **多地备份**：将备份文件存储在多个位置
4. **版本管理**：保留多个版本的备份文件

### 恢复流程
1. 准备备份文件（JSON格式）
2. 登录管理后台
3. 进入"数据管理"页面
4. 选择导入选项（建议先测试增量导入）
5. 上传备份文件
6. 确认导入结果

## 开发

### 项目结构

```
src/
├── app/                 # Next.js App Router
│   ├── api/            # API 路由
│   │   └── admin/      # 管理员API
│   │       ├── data/   # 数据管理API
│   │       └── links/  # 链接管理API
│   ├── admin/          # 管理页面
│   └── login/          # 登录页面
├── components/         # React 组件
├── lib/               # 工具库和服务
│   ├── data-service.ts # 数据导入导出服务
│   └── shortlink-service.ts # 短链接服务
└── middleware.ts      # 中间件
```

### 环境要求

- Node.js 18+
- pnpm 8+

## 许可证

MIT License
